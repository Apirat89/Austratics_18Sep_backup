# Residential Data File Update Project Plan

## ðŸš¨ **RESIDENTIAL DATA FILE UPDATE PROJECT**

**USER REQUEST:** Update the residential page to use the new data file `Residential_May2025_ExcludeMPS_updated3.json` instead of the current `Residential_May2025_ExcludeMPS_updated.json`, and specifically update the box plot data for the "residential_places" variable which has been updated in the new file.

**ðŸ“Š CURRENT DATA ANALYSIS:**
- âœ… **Current File**: `/Maps_ABS_CSV/Residential_May2025_ExcludeMPS_updated.json` (via finance version)
- âœ… **New File**: `/Maps_ABS_CSV/Residential_May2025_ExcludeMPS_updated3.json` (uploaded by user)
- âœ… **Key Update**: `residential_places` field has updated values that require box plot recalculation
- âœ… **File Structure**: JSON structure appears consistent (same schema)

**ðŸ“‹ AFFECTED COMPONENTS:**
- âœ… **Residential Page**: `/src/app/residential/page.tsx` - Main data loading
- âœ… **Residential Compare Page**: `/src/app/residential/compare/page.tsx` - Comparison data loading  
- âœ… **Hybrid Facility Service**: `/src/lib/HybridFacilityService.ts` - Merged data loading
- âœ… **Box Plot Components**: All residential box plot components use statistics file
- âœ… **Statistics File**: `/public/maps/abs_csv/Residential_Statistics_Analysis.json` - Requires regeneration

**ðŸŽ¯ IMPLEMENTATION OBJECTIVES:**
Switch data source from old file to new file and regenerate statistical analysis to ensure accurate box plot data for residential_places and all other metrics.

**PLANNER MODE ACTIVE** ðŸ§ 

## Background and Motivation

The user has uploaded a newer version of the residential aged care facilities dataset (`Residential_May2025_ExcludeMPS_updated3.json`) that contains updated `residential_places` data. This field is used extensively in:

1. **Box Plot Visualizations**: Statistical comparisons showing how individual facilities compare to nationwide, state, postcode, and locality benchmarks
2. **Facility Information Display**: Showing capacity information for each residential facility
3. **Comparison Tables**: Side-by-side facility comparisons

The current system loads data from multiple sources, and changing the data file requires coordinated updates across several components and regeneration of statistical analysis to ensure accurate visualizations.

**Key Requirements:**
1. **Data Source Updates**: Update all file paths from old to new data file
2. **Statistical Regeneration**: Recalculate all statistics including residential_places benchmarks
3. **Consistency**: Ensure all components use the same data source
4. **Performance**: Maintain current loading performance and user experience
5. **No Feature Changes**: Only update data source, no additional functionality changes

**Strategic Importance:** Accurate and current data is essential for users making informed decisions about residential aged care facilities.

## Key Challenges and Analysis

### **Challenge 1: Multiple Data Loading Points**
**Issue**: The residential data is loaded from multiple locations in the codebase
**Impact**: Need to update all references consistently to avoid data inconsistencies
**Evidence**: Found 4+ different components loading the residential data file
**Solution**: Systematic update of all file references

### **Challenge 2: Statistical Data Dependencies**
**Issue**: Box plots depend on pre-calculated statistics that are generated by a separate script
**Impact**: Changing data file requires regenerating statistics for accurate visualizations
**Evidence**: Statistics are loaded from `Residential_Statistics_Analysis.json` generated by `calculate_residential_stats.js`
**Solution**: Run statistics generation script after updating data source

### **Challenge 3: File Path Inconsistencies**
**Issue**: Some components load from `/maps/abs_csv/` while others load from `/Maps_ABS_CSV/`
**Impact**: Need to ensure consistent file location and update both public and source directories
**Evidence**: Different paths found in various components
**Solution**: Standardize on one location and ensure file availability

### **Challenge 4: Copy Location Requirements**
**Issue**: Files need to exist in both source directory (`Maps_ABS_CSV`) and public directory (`/public/maps/abs_csv/`)
**Impact**: Need to copy files to correct locations for web access
**Evidence**: Components load from `/maps/abs_csv/` which maps to public directory
**Solution**: Copy new file to both locations

### **Challenge 5: Finance Data Integration**
**Issue**: Current system loads "with_finance" version but new file may not have finance suffix
**Impact**: Need to verify if finance data is included or update component logic
**Evidence**: Found references to `_with_finance.json` version
**Solution**: Check new file structure and update accordingly

## High-level Task Breakdown

### **Phase 1: File Analysis & Preparation**

#### **Task 1.1: New File Structure Analysis**
**Objective**: Understand the structure and content of the new data file
**Actions**:
- Examine the structure of `Residential_May2025_ExcludeMPS_updated3.json`
- Compare key fields with the current file to ensure compatibility
- Verify that all required fields (including financial data) are present
- Document any structural differences that might affect components

**Success Criteria**: Complete understanding of new file structure and compatibility

#### **Task 1.2: Current File Reference Inventory**
**Objective**: Catalog all locations where the old file is referenced
**Actions**:
- List all components that load `Residential_May2025_ExcludeMPS_updated.json`
- List all components that load `Residential_May2025_ExcludeMPS_updated_with_finance.json`
- Document the exact file paths used in each component
- Identify any hardcoded references that need updates

**Success Criteria**: Complete inventory of all file references requiring updates

#### **Task 1.3: File Deployment Strategy**
**Objective**: Plan where and how to deploy the new file
**Actions**:
- Copy new file to `/Maps_ABS_CSV/` directory (already done)
- Plan copy to `/public/maps/abs_csv/` directory for web access
- Determine if existing files should be backed up or replaced
- Plan file naming strategy (keep same name or update references)

**Success Criteria**: Clear deployment strategy for file distribution

### **Phase 2: Data Source Updates**

#### **Task 2.1: Residential Page Component Updates**
**Objective**: Update main residential page to use new data file
**Actions**:
- Update `src/app/residential/page.tsx` line 418: Change file reference
- Update `src/app/residential/page-full-backup.tsx` line 179: Change file reference
- Test that data loads correctly from new file
- Verify no breaking changes in component functionality

**Success Criteria**: Residential page loads data from new file without errors

#### **Task 2.2: Comparison Page Updates**
**Objective**: Update residential comparison functionality to use new data
**Actions**:
- Update `src/app/residential/compare/page.tsx` line 225: Change file reference
- Test comparison functionality with new data
- Verify that facility comparisons work correctly
- Check that all comparison table fields display properly

**Success Criteria**: Residential comparison page works with new data source

#### **Task 2.3: Service Layer Updates**
**Objective**: Update service classes that load residential data
**Actions**:
- Update `src/lib/HybridFacilityService.ts` line 96: Change file reference
- Update `src/lib/ResidentialFacilityService.ts` line 83: Change file reference (if needed)
- Test that service layer functions correctly with new data
- Verify that map integrations continue to work

**Success Criteria**: All service layer components use new data source successfully

#### **Task 2.4: File Deployment & Access**
**Objective**: Deploy new file to web-accessible location
**Actions**:
- Copy new file to `/public/maps/abs_csv/` directory
- Name it appropriately (determine if finance suffix needed)
- Test that HTTP requests to new file succeed
- Remove or backup old file if needed

**Success Criteria**: New file is web-accessible and all HTTP requests succeed

### **Phase 3: Statistical Analysis Regeneration**

#### **Task 3.1: Statistics Script Configuration**
**Objective**: Update statistics generation script to use new data file
**Actions**:
- Update `scripts/calculate_residential_stats.js` line 5: Change input file path
- Point script to new `Residential_May2025_ExcludeMPS_updated3.json` file
- Verify script can read new file format correctly
- Check that all expected fields are present for analysis

**Success Criteria**: Statistics script configured to process new data file

#### **Task 3.2: Statistics Generation Execution**
**Objective**: Generate new statistical analysis with updated residential_places data
**Actions**:
- Run `scripts/calculate_residential_stats.js` to generate new statistics
- Verify that residential_places statistics are calculated correctly
- Check that all other metrics are properly calculated
- Ensure output files are generated in correct locations

**Success Criteria**: New `Residential_Statistics_Analysis.json` file generated with updated statistics

#### **Task 3.3: Statistics Validation & Deployment**
**Objective**: Validate and deploy new statistical data
**Actions**:
- Verify that new statistics file contains residential_places data
- Check that statistical values are reasonable (no extreme outliers)
- Copy statistics file to `/public/maps/abs_csv/` for web access
- Test that box plot components can load new statistics

**Success Criteria**: New statistics file deployed and accessible to components

### **Phase 4: Box Plot Data Updates**

#### **Task 4.1: Box Plot Component Testing**
**Objective**: Verify that box plot components use updated residential_places data
**Actions**:
- Test `ResidentialBoxPlots.tsx` with new data and statistics
- Test `InlineBoxPlot.tsx` component functionality
- Test `TabBoxPlots.tsx` component functionality
- Verify that residential_places box plots display correctly

**Success Criteria**: All box plot components display updated residential_places data

#### **Task 4.2: Statistical Visualization Verification**
**Objective**: Ensure all statistical comparisons reflect new data
**Actions**:
- Test nationwide scope statistics for residential_places
- Test state-level scope statistics for residential_places
- Test postcode-level scope statistics for residential_places
- Test locality-level scope statistics for residential_places
- Verify facility values appear correctly against new benchmarks

**Success Criteria**: All geographic scopes show accurate residential_places statistics

#### **Task 4.3: End-to-End Data Flow Testing**
**Objective**: Verify complete data flow from file to visualization
**Actions**:
- Test complete user workflow: search â†’ select facility â†’ view box plots
- Verify residential_places field displays correctly in facility details
- Test residential_places in comparison tables
- Check residential_places in all tabs and views

**Success Criteria**: Complete data flow works correctly with updated residential_places data

### **Phase 5: Validation & Cleanup**

#### **Task 5.1: Comprehensive Data Validation**
**Objective**: Ensure data integrity across all components
**Actions**:
- Verify that facility data loads correctly in all components
- Check that no facilities are missing or have incorrect data
- Validate that all financial data is still accessible
- Test that search functionality works with new data

**Success Criteria**: All data integrity checks pass

#### **Task 5.2: Performance Verification**
**Objective**: Ensure performance remains consistent with new file
**Actions**:
- Measure page load times with new data file
- Check that search performance is maintained
- Verify that statistics loading performance is acceptable
- Test memory usage during data processing

**Success Criteria**: Performance metrics meet or exceed current levels

#### **Task 5.3: User Experience Testing**
**Objective**: Verify no user-facing changes except updated data
**Actions**:
- Test complete residential page functionality
- Test comparison functionality with multiple facilities
- Verify that box plots display correctly for different facilities
- Check that no UI elements are broken or changed unexpectedly

**Success Criteria**: User experience remains consistent with updated data

## Project Status Board

### **Phase 1: File Analysis & Preparation**
- **Task 1.1**: New File Structure Analysis - **PENDING**
- **Task 1.2**: Current File Reference Inventory - **PENDING**
- **Task 1.3**: File Deployment Strategy - **PENDING**

### **Phase 2: Data Source Updates**
- **Task 2.1**: Residential Page Component Updates - **PENDING**
- **Task 2.2**: Comparison Page Updates - **PENDING**
- **Task 2.3**: Service Layer Updates - **PENDING**
- **Task 2.4**: File Deployment & Access - **PENDING**

### **Phase 3: Statistical Analysis Regeneration**
- **Task 3.1**: Statistics Script Configuration - **PENDING**
- **Task 3.2**: Statistics Generation Execution - **PENDING**
- **Task 3.3**: Statistics Validation & Deployment - **PENDING**

### **Phase 4: Box Plot Data Updates**
- **Task 4.1**: Box Plot Component Testing - **PENDING**
- **Task 4.2**: Statistical Visualization Verification - **PENDING**
- **Task 4.3**: End-to-End Data Flow Testing - **PENDING**

### **Phase 5: Validation & Cleanup**
- **Task 5.1**: Comprehensive Data Validation - **PENDING**
- **Task 5.2**: Performance Verification - **PENDING**
- **Task 5.3**: User Experience Testing - **PENDING**

## Executor's Feedback or Assistance Requests

**ðŸŽ¯ READY FOR EXECUTION**

**ðŸ“‹ COMPREHENSIVE PLAN COMPLETE:**

**SCOPE SUMMARY:**
- âœ… **4 Component Updates**: Main page, comparison page, and 2 service layers
- âœ… **1 Statistics Regeneration**: Complete recalculation with new residential_places data
- âœ… **3 Box Plot Components**: All will automatically use new statistics
- âœ… **File Deployment**: Copy to public directory for web access
- âœ… **Zero Feature Changes**: Only data source updates as requested

**EXECUTION SEQUENCE:**
1. **Phase 1**: Analysis and preparation (understand new file)
2. **Phase 2**: Update all component file references  
3. **Phase 3**: Regenerate statistics with new data
4. **Phase 4**: Test box plots with updated residential_places data
5. **Phase 5**: Comprehensive validation

**KEY FILES TO MODIFY:**
- `src/app/residential/page.tsx` (line 418)
- `src/app/residential/compare/page.tsx` (line 225)
- `src/lib/HybridFacilityService.ts` (line 96)
- `scripts/calculate_residential_stats.js` (line 5)

**FILES TO GENERATE:**
- New `/public/maps/abs_csv/Residential_Statistics_Analysis.json`
- Copy of new data file in public directory

**ESTIMATED IMPACT:**
- âœ… **Low Risk**: Only data file changes, no logic changes
- âœ… **High Value**: Updated residential_places box plot data as requested
- âœ… **Quick Execution**: Most work is file references and script execution

**Ready to proceed to Executor mode for implementation.**

## Lessons

*To be updated as implementation progresses* 